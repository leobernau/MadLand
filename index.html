<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Monster Survival Game</title>
<style>
  body { margin:0; overflow:hidden; background:#222; color:white; font-family:sans-serif;}
  canvas { display:block; margin:0 auto; background:#333;}
  #ui { position:absolute; top:10px; left:10px;}
  #upgrades { position:absolute; bottom:10px; left:50%; transform:translateX(-50%); display:flex; gap:10px;}
  .upgrade-btn { background:#555; padding:10px; border-radius:5px; cursor:pointer; }
</style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<div id="ui">
  <div>Level: <span id="level">1</span> | Kristalle: <span id="crystals">0</span> | Zeit: <span id="timer">0:00</span></div>
</div>
<div id="upgrades"></div>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const levelEl = document.getElementById('level');
const crystalsEl = document.getElementById('crystals');
const timerEl = document.getElementById('timer');
const upgradesEl = document.getElementById('upgrades');

let keys = {};
let gameTime = 0;
let player = {x:400, y:300, size:20, speed:2, hp:100, bullets:[], upgrades:[], crystals:0, level:1};
let monsters = [];
let monsterTypes = [
  {name:'Ork', hp:10, speed:1, color:'green'},
  {name:'Drache', hp:50, speed:0.5, color:'red'},
  {name:'Schlange', hp:15, speed:2, color:'purple'},
  {name:'Hexe', hp:20, speed:1.5, color:'orange'}
];
let upgradesList = [
  {name:"Bienen", desc:"Bienen attackieren Gegner", level:0, max:5, effect:["Kleine Bienen","Mehr Bienen","Größere Reichweite","Honigspuren","Bärenkönig"]},
  {name:"Feuerball", desc:"Schieße Feuerbälle", level:0, max:5, effect:["Kleiner Feuerball","Stärkerer Feuerball","Explosiver Feuerball","Flammenspur","Inferno"]},
  {name:"Heilung", desc:"Heile dich langsam", level:0, max:5, effect:["Langsam heilen","Schneller heilen","Heilkreis","Heilende Aura","Göttliche Heilung"]},
  // Füge hier weitere Upgrades hinzu, insgesamt 30
];

// --- Input ---
window.addEventListener('keydown', e => keys[e.key] = true);
window.addEventListener('keyup', e => keys[e.key] = false);

// --- Spiel-Loop ---
function spawnMonster() {
  let type = monsterTypes[Math.floor(Math.random() * monsterTypes.length)];
  let edge = Math.floor(Math.random()*4);
  let x = edge===0?0:edge===1?canvas.width:Math.random()*canvas.width;
  let y = edge===2?0:edge===3?canvas.height:Math.random()*canvas.height;
  monsters.push({x,y,type:type.name,hp:type.hp,speed:type.speed,color:type.color});
}

function shootBullet() {
  player.bullets.push({x:player.x, y:player.y, dx:Math.cos(player.angle)*5, dy:Math.sin(player.angle)*5});
}

function pickUpUpgrade() {
  upgradesEl.innerHTML = '';
  let options = [];
  while(options.length < 3) {
    let u = upgradesList[Math.floor(Math.random()*upgradesList.length)];
    if(!options.includes(u)) options.push(u);
  }
  options.forEach(u => {
    let btn = document.createElement('div');
    btn.className = 'upgrade-btn';
    btn.innerText = u.name + " (" + u.effect[u.level] + ")";
    btn.onclick = () => {
      u.level++;
      player.upgrades.push(u.name);
      upgradesEl.innerHTML = '';
    }
    upgradesEl.appendChild(btn);
  });
}

function update(dt) {
  // Timer
  gameTime += dt;
  timerEl.innerText = Math.floor(gameTime/60) + ":" + ("0"+Math.floor(gameTime%60)).slice(-2);

  // Bewegung
  if(keys['w']) player.y -= player.speed;
  if(keys['s']) player.y += player.speed;
  if(keys['a']) player.x -= player.speed;
  if(keys['d']) player.x += player.speed;

  // Schießen
  if(keys[' ']) shootBullet();

  // Bullets bewegen
  player.bullets.forEach(b => {b.x+=b.dx; b.y+=b.dy;});
  player.bullets = player.bullets.filter(b => b.x>=0 && b.x<=canvas.width && b.y>=0 && b.y<=canvas.height);

  // Monster bewegen
  monsters.forEach(m => {
    let dx = player.x - m.x;
    let dy = player.y - m.y;
    let dist = Math.sqrt(dx*dx + dy*dy);
    m.x += (dx/dist)*m.speed;
    m.y += (dy/dist)*m.speed;
  });

  // Kollisionen
  player.bullets.forEach(b=>{
    monsters.forEach(m=>{
      let dx = b.x-m.x, dy=b.y-m.y;
      if(Math.sqrt(dx*dx+dy*dy)<15){
        m.hp--;
        b.hit=true;
        if(m.hp<=0){
          player.crystals++;
          crystalsEl.innerText = player.crystals;
          if(player.crystals % 5 === 0) pickUpUpgrade();
        }
      }
    });
  });
  player.bullets = player.bullets.filter(b=>!b.hit);
  monsters = monsters.filter(m=>m.hp>0);

  // Spawn
  if(Math.random()<0.02) spawnMonster();
}

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // Spieler
  ctx.fillStyle='blue';
  ctx.beginPath();
  ctx.arc(player.x,player.y,player.size,0,Math.PI*2);
  ctx.fill();
  // Bullets
  ctx.fillStyle='yellow';
  player.bullets.forEach(b=>{
    ctx.beginPath();
    ctx.arc(b.x,b.y,5,0,Math.PI*2);
    ctx.fill();
  });
  // Monster
  monsters.forEach(m=>{
    ctx.fillStyle = m.color;
    ctx.beginPath();
    ctx.arc(m.x,m.y,15,0,Math.PI*2);
    ctx.fill();
  });
}

let lastTime = 0;
function loop(ts) {
  let dt = (ts-lastTime)/1000;
  lastTime=ts;
  update(dt);
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>
</body>
</html>
