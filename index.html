<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Monster Survival Game</title>
<style>
body { margin:0; overflow:hidden; background:#222; font-family:sans-serif;}
canvas { display:block; margin:0 auto; background:#333;}
#ui { position:absolute; top:10px; left:10px; color:white;}
#upgrades { position:absolute; bottom:10px; left:50%; transform:translateX(-50%); display:flex; gap:10px;}
.upgrade-btn { background:#555; padding:10px; border-radius:5px; cursor:pointer;}
</style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<div id="ui">
Level: <span id="level">1</span> | Kristalle: <span id="crystals">0</span> | Zeit: <span id="timer">0:00</span>
</div>
<div id="upgrades"></div>
<script>
const canvas=document.getElementById('gameCanvas');
const ctx=canvas.getContext('2d');
const levelEl=document.getElementById('level');
const crystalsEl=document.getElementById('crystals');
const timerEl=document.getElementById('timer');
const upgradesEl=document.getElementById('upgrades');

let keys={};
let gameTime=0;
let spawnTimer=0;

let player={x:400,y:300,size:20,speed:2,hp:100,bullets:[],upgrades:[],crystals:0,level:1,helpers:[],angle:0};

let monsters=[];
let monsterTypes=[
{name:'Ork',hp:10,speed:1,color:'green'},
{name:'Drache',hp:50,speed:0.5,color:'red'},
{name:'Schlange',hp:15,speed:2,color:'purple'},
{name:'Hexe',hp:20,speed:1.5,color:'orange'}
];

let upgradesList=[
{name:"Bienen",desc:"Bienen attackieren Gegner",level:0,max:5,effect:["Kleine Bienen","Mehr Bienen","Größere Reichweite","Honigspuren","Bärenkönig"]},
{name:"Feuerball",desc:"Schieße Feuerbälle",level:0,max:5,effect:["Kleiner Feuerball","Stärkerer Feuerball","Explosiver Feuerball","Flammenspur","Inferno"]},
{name:"Heilung",desc:"Heile dich langsam",level:0,max:5,effect:["Langsam heilen","Schneller heilen","Heilkreis","Heilende Aura","Göttliche Heilung"]},
{name:"Blitz",desc:"Blitze schlagen ein",level:0,max:5,effect:["Kleiner Blitz","Mehr Blitze","Blitzkette","Blitzfeld","Donnersturm"]},
{name:"Eis",desc:"Verlangsame Gegner",level:0,max:5,effect:["Kleine Eiswellen","Mehr Eiswellen","Gefrierfeld","Eissturm","Eiskönig"]},
{name:"Stein",desc:"Steine fallen auf Gegner",level:0,max:5,effect:["Ein Stein","Mehr Steine","Große Steine","Felslawine","Titanischer Stein"]},
{name:"Gift",desc:"Vergifte Gegner",level:0,max:5,effect:["Langsames Gift","Schnelles Gift","Giftwolke","Tödliches Gift","Giftmeister"]},
{name:"Schild",desc:"Schutzschild",level:0,max:5,effect:["Kleiner Schild","Stärkerer Schild","Rundumschild","Magischer Schild","Göttlicher Schild"]},
{name:"Doppelgänger",desc:"Hilfreicher Doppelgänger",level:0,max:5,effect:["Kleiner Helfer","Stärkerer Helfer","Mehr Helfer","Armee","Meister-Doppelgänger"]},
{name:"Feuerregen",desc:"Feuerregen auf Gegner",level:0,max:5,effect:["Kleiner Regen","Größerer Regen","Flammenmeer","Inferno","Apokalypse"]},
{name:"Teleport",desc:"Teleportiere dich",level:0,max:5,effect:["Kurzer Sprung","Mittlerer Sprung","Langer Sprung","Blink","Göttlicher Sprung"]},
{name:"Magnet",desc:"Ziehe Kristalle an",level:0,max:5,effect:["Kleiner Magnet","Stärkerer Magnet","Großer Magnet","Kristallstrudel","Supermagnet"]},
{name:"Wind",desc:"Wind stößt Gegner zurück",level:0,max:5,effect:["Kleiner Wind","Stärkerer Wind","Windfeld","Sturm","Orkan"]},
{name:"Laser",desc:"Laserstrahl schießt durch Gegner",level:0,max:5,effect:["Kurzer Strahl","Längerer Strahl","Mehr Strahlen","Laserkanone","Superlaser"]},
{name:"Schnelligkeit",desc:"Erhöht Bewegung",level:0,max:5,effect:["Leicht schneller","Schneller","Sehr schnell","Extrem schnell","Blitzgeschwindigkeit"]},
{name:"Doppelschuss",desc:"Zwei Schüsse gleichzeitig",level:0,max:5,effect:["Doppelschuss","Mehr Schaden","Schneller","Streuschuss","Ultimativ"]},
{name:"Rüstung",desc:"Reduziert Schaden",level:0,max:5,effect:["Leichte Rüstung","Mittlere Rüstung","Schwere Rüstung","Magische Rüstung","Götterrüstung"]},
{name:"Explosion",desc:"Explodierende Attacke",level:0,max:5,effect:["Kleine Explosion","Mittlere Explosion","Große Explosion","Megaexplosion","Apokalypse"]},
{name:"Frostnova",desc:"Eissturm um dich",level:0,max:5,effect:["Kleiner Frost","Mittlerer Frost","Großer Frost","Eissturm","Frostkönig"]},
{name:"Drachenruf",desc:"Rufe Drachen",level:0,max:5,effect:["Ein Drache","Zwei Drachen","Drei Drachen","Drachenhorde","Drachenkönig"]},
{name:"Heiltrank",desc:"Sofortige Heilung",level:0,max:5,effect:["Kleiner Trank","Mittlerer Trank","Großer Trank","Riesen-Trank","Elixier des Lebens"]},
{name:"Kettenblitz",desc:"Blitz springt zu Gegnern",level:0,max:5,effect:["Ein Sprung","Zwei Sprünge","Drei Sprünge","Vier Sprünge","Blitzmeister"]},
{name:"Verlangsamung",desc:"Verlangsamt Gegner",level:0,max:5,effect:["Leicht","Mittel","Stark","Sehr stark","Ultimativ"]},
{name:"Teleportbomben",desc:"Werfe Bomben beim Teleport",level:0,max:5,effect:["Eine Bombe","Zwei Bomben","Drei Bomben","Vier Bomben","Gottbomben"]},
{name:"Sonnenstrahl",desc:"Strahl von oben",level:0,max:5,effect:["Schwach","Stark","Sehr stark","Mega","Ultimativ"]},
{name:"RufderToten",desc:"Skelette helfen dir",level:0,max:5,effect:["Ein Skelett","Zwei","Drei","Horde","Untot-König"]},
{name:"MagischeFallen",desc:"Fallen auf Boden",level:0,max:5,effect:["Kleine Falle","Größere Falle","Mehr Fallen","Fallenfeld","Ultimative Falle"]}
];

// --- Input ---
window.addEventListener('keydown',e=>keys[e.key]=true);
window.addEventListener('keyup',e=>keys[e.key]=false);
canvas.addEventListener('mousemove', e=>{
  let rect=canvas.getBoundingClientRect();
  player.angle=Math.atan2(e.clientY-rect.top-player.y,e.clientX-rect.left-player.x);
});

// --- Funktionen ---
function spawnMonster(){
  let type=monsterTypes[Math.floor(Math.random()*monsterTypes.length)];
  let edge=Math.floor(Math.random()*4);
  let x=edge===0?0:edge===1?canvas.width:Math.random()*canvas.width;
  let y=edge===2?0:edge===3?canvas.height:Math.random()*canvas.height;
  monsters.push({x,y,type:type.name,hp:type.hp,speed:type.speed,color:type.color});
}

function shootBullet(){
  player.bullets.push({x:player.x,y:player.y,dx:Math.cos(player.angle)*5,dy:Math.sin(player.angle)*5});
}

function pickUpUpgrade(){
  upgradesEl.innerHTML='';
  let options=[];
  while(options.length<3){
    let u=upgradesList[Math.floor(Math.random()*upgradesList.length)];
    if(!options.includes(u)) options.push(u);
  }
  options.forEach(u=>{
    let btn=document.createElement('div');
    btn.className='upgrade-btn';
    btn.innerText=u.name + " (" + u.effect[u.level] + ")";
    btn.onclick=()=>{
      u.level++; 
      player.upgrades.push(u.name);
      upgradesEl.innerHTML='';
    }
    upgradesEl.appendChild(btn);
  });
}

// --- Update ---
function update(dt){
  gameTime+=dt;
  timerEl.innerText=Math.floor(gameTime/60)+":" + ("0"+Math.floor(gameTime%60)).slice(-2);

  if(keys['w']) player.y-=player.speed;
  if(keys['s']) player.y+=player.speed;
  if(keys['a']) player.x-=player.speed;
  if(keys['d']) player.x+=player.speed;

  if(keys[' ']) shootBullet();

  player.bullets.forEach(b=>{b.x+=b.dx;b.y+=b.dy;});
  player.bullets=player.bullets.filter(b=>b.x>=0 && b.x<=canvas.width && b.y>=0 && b.y<=canvas.height);

  monsters.forEach(m=>{
    let dx=player.x-m.x, dy=player.y-m.y;
    let dist=Math.sqrt(dx*dx+dy*dy);
    m.x+=(dx/dist)*m.speed;
    m.y+=(dy/dist)*m.speed;
  });

  player.bullets.forEach(b=>{
    monsters.forEach(m=>{
      let dx=b.x-m.x, dy=b.y-m.y;
      if(Math.sqrt(dx*dx+dy*dy)<15){
        m.hp--;
        b.hit=true;
        if(m.hp<=0){
          player.crystals++;
          crystalsEl.innerText=player.crystals;
          if(player.crystals%5===0) pickUpUpgrade();
        }
      }
    });
  });
  player.bullets=player.bullets.filter(b=>!b.hit);
  monsters=monsters.filter(m=>m.hp>0);

  spawnTimer+=dt;
  if(spawnTimer>0.5){
    spawnMonster();
    spawnTimer=0;
  }
}

// --- Draw ---
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Spieler
  ctx.save();
  ctx.translate(player.x,player.y);
  ctx.rotate(player.angle);
  ctx.fillStyle='blue';
  ctx.beginPath();
  ctx.moveTo(15,0);
  ctx.lineTo(-10,10);
  ctx.lineTo(-10,-10);
  ctx.closePath();
  ctx.fill();
  ctx.restore();

  // Bullets
  ctx.fillStyle='yellow';
  player.bullets.forEach(b=>{
    ctx.beginPath();
    ctx.arc(b.x,b.y,5,0,Math.PI*2);
    ctx.fill();
  });

  // Monster
  monsters.forEach(m=>{
    ctx.fillStyle=m.color;
    ctx.beginPath();
    ctx.arc(m.x,m.y,15,0,Math.PI*2);
    ctx.fill();
  });
}

// --- Loop ---
let lastTime=0;
function loop(ts){
  let dt=(ts-lastTime)/1000;
  lastTime=ts;
  update(dt);
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>
</body>
</html>
